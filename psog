local HttpService = game:GetService("HttpService")

-- Fetch pets data
local function fetchPetsDatabase()
    local success, response = pcall(function()
        local apiResponse = game:HttpGet("https://petsgo.biggamesapi.io/api/collection/Pets")
        return HttpService:JSONDecode(apiResponse)
    end)

    if success then
        print("Pets Database Data: ", response)  -- Print the entire pets data
        return response -- Return decoded pets data
    else
        warn("⚠️ Failed to fetch pets data!")
        return nil
    end
end

-- Fetch RAP data
local function fetchRAPData()
    local success, response = pcall(function()
        local apiResponse = game:HttpGet("https://petsgo.biggamesapi.io/api/rap")
        return HttpService:JSONDecode(apiResponse)
    end)

    if success then
        print("RAP Data: ", response)  -- Print the entire RAP data
        return response -- Return decoded RAP data
    else
        warn("⚠️ Failed to fetch RAP data!")
        return nil
    end
end

-- Function to get RAP value for a specific pet
local function getRAPValue(petName, rapData)
    for _, pet in ipairs(rapData) do
        if pet.configData.id == petName then
            local rapValue = pet.value  -- Define rapValue here
            return rapValue  -- Return the rapValue
        end
    end
    return nil -- Return nil if pet not found
end

-- Adjust Cost Based on RAP
local function getAdjustedCost(petName, originalCost, rapData)
    if type(originalCost) == "string" and originalCost:match("%%$") then
        local percentage = tonumber(originalCost:match("(%d+)")) / 100
        local rapValue = getRAPValue(petName, rapData)
        
        if rapValue then
            print("RAP Value for " .. petName .. ": " .. rapValue) -- Print the RAP value
            return math.floor(rapValue * percentage) -- Apply percentage to RAP
        else
            warn("⚠️ Missing RAP data for:", petName)
            return nil
        end
    end

    return originalCost -- Return original cost if it's not a percentage
end

-- Example of how to call the functions
local petName = "Huge Piggy"
local rapData = fetchRAPData() -- Fetch RAP data

if rapData then
    local rapValue = getRAPValue(petName, rapData)
    if rapValue then
        print("RAP Value for " .. petName .. ": " .. rapValue)
    else
        print("RAP value not found for " .. petName)
    end
else
    print("Failed to fetch RAP data.")
end
